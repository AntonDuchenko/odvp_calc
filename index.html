<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Калькулятор облигаций с реинвестированием</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
        font-weight: bold;
      }
      input[type="number"] {
        width: 100px;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 3px;
      }
      .result {
        background-color: #e8f5e8;
        font-weight: bold;
      }
      .best {
        background-color: #90ee90;
        font-weight: bold;
      }
      .comparison {
        display: flex;
        gap: 20px;
      }
      .variant {
        flex: 1;
        min-width: 300px;
      }
      .formula {
        font-family: monospace;
        background-color: #f0f0f0;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
      }
      h1,
      h2 {
        color: #333;
      }
    </style>
  </head>
  <body>
    <h1>Калькулятор облигаций с реинвестированием купонов</h1>

    <div class="comparison">
      <div class="variant">
        <div class="container">
          <h2>Вариант 1</h2>
          <table>
            <tr>
              <th>Параметр</th>
              <th>Значение</th>
            </tr>
            <tr>
              <td>Номинал (грн)</td>
              <td>
                <input
                  type="number"
                  id="nominal1"
                  value="1000"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Цена покупки (грн)</td>
              <td>
                <input
                  type="number"
                  id="price1"
                  value="1071"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Комиссия (%)</td>
              <td>
                <input
                  type="number"
                  id="commission1"
                  value="1.5"
                  step="0.1"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Годовая ставка (%)</td>
              <td>
                <input
                  type="number"
                  id="rate1"
                  value="17.5"
                  step="0.1"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Срок (годы)</td>
              <td>
                <input
                  type="number"
                  id="term1"
                  value="1.5"
                  step="0.1"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Количество купонов</td>
              <td>
                <input
                  type="number"
                  id="coupons1"
                  value="4"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr class="result">
              <td>Общие инвестиции</td>
              <td id="investment1">-</td>
            </tr>
            <tr class="result">
              <td>Эффективная доходность</td>
              <td id="yield1">-</td>
            </tr>
          </table>
        </div>
      </div>

      <div class="variant">
        <div class="container">
          <h2>Вариант 2</h2>
          <table>
            <tr>
              <th>Параметр</th>
              <th>Значение</th>
            </tr>
            <tr>
              <td>Номинал (грн)</td>
              <td>
                <input
                  type="number"
                  id="nominal2"
                  value="1000"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Цена покупки (грн)</td>
              <td>
                <input
                  type="number"
                  id="price2"
                  value="1015"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Комиссия (%)</td>
              <td>
                <input
                  type="number"
                  id="commission2"
                  value="1.5"
                  step="0.1"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Годовая ставка (%)</td>
              <td>
                <input
                  type="number"
                  id="rate2"
                  value="18.4"
                  step="0.1"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Срок (годы)</td>
              <td>
                <input
                  type="number"
                  id="term2"
                  value="2.5"
                  step="0.1"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Количество купонов</td>
              <td>
                <input
                  type="number"
                  id="coupons2"
                  value="7"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr class="result">
              <td>Общие инвестиции</td>
              <td id="investment2">-</td>
            </tr>
            <tr class="result">
              <td>Эффективная доходность</td>
              <td id="yield2">-</td>
            </tr>
          </table>
        </div>
      </div>

      <div class="variant">
        <div class="container">
          <h2>Вариант 3</h2>
          <table>
            <tr>
              <th>Параметр</th>
              <th>Значение</th>
            </tr>
            <tr>
              <td>Номинал (грн)</td>
              <td>
                <input
                  type="number"
                  id="nominal3"
                  value="1000"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Цена покупки (грн)</td>
              <td>
                <input
                  type="number"
                  id="price3"
                  value="1054"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Комиссия (%)</td>
              <td>
                <input
                  type="number"
                  id="commission3"
                  value="0"
                  step="0.1"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Годовая ставка (%)</td>
              <td>
                <input
                  type="number"
                  id="rate3"
                  value="16"
                  step="0.1"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Срок (годы)</td>
              <td>
                <input
                  type="number"
                  id="term3"
                  value="1.25"
                  step="0.1"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr>
              <td>Количество купонов</td>
              <td>
                <input
                  type="number"
                  id="coupons3"
                  value="3"
                  oninput="calculate()"
                />
              </td>
            </tr>
            <tr class="result">
              <td>Общие инвестиции</td>
              <td id="investment3">-</td>
            </tr>
            <tr class="result">
              <td>Эффективная доходность</td>
              <td id="yield3">-</td>
            </tr>
          </table>
        </div>
      </div>
    </div>

    <div class="container">
      <h2>Детальный расчет (для выбранного варианта)</h2>
      <p>
        Выберите вариант для детального расчета:
        <select id="detailVariant" onchange="showDetail()">
          <option value="1">Вариант 1</option>
          <option value="2">Вариант 2</option>
          <option value="3">Вариант 3</option>
        </select>
      </p>
      <div id="detailTable"></div>
    </div>

    <div class="container">
      <h2>Анализ: Почему короткие сроки часто выгоднее?</h2>
      <div class="formula">
        <strong>Причины:</strong><br />
        1. <strong>Премия к номиналу</strong> - вы покупаете облигации дороже
        1000 грн<br />
        2. <strong>Комиссия</strong> - съедает доходность, особенно на длинных
        сроках<br />
        3. <strong>Время окупаемости</strong> - чем дольше срок, тем дольше
        "работает" переплата<br />
        4. <strong>Эффект компаундинга</strong> - не всегда компенсирует высокую
        цену покупки
      </div>

      <h2>Формулы для Excel</h2>
      <h3>Основные формулы:</h3>
      <div class="formula">
        <strong>Общие инвестиции:</strong><br />
        =B3*(1+B4/100)
      </div>
      <div class="formula">
        <strong>Размер купона:</strong><br />
        =B2*B5/100/B7
      </div>
      <div class="formula">
        <strong>Будущая стоимость купона с реинвестированием:</strong><br />
        =Купон*(1+Годовая_ставка/100)^Время_до_погашения
      </div>
      <div class="formula">
        <strong>Эффективная доходность:</strong><br />
        =(Итоговая_сумма/Начальные_инвестиции)^(1/Срок_в_годах)-1
      </div>

      <h3>Проверка расчетов:</h3>
      <div class="formula">
        <strong>Простая проверка без реинвестирования:</strong><br />
        Доходность = (Все_купоны + Номинал - Цена_с_комиссией) /
        Цена_с_комиссией / Срок_в_годах
      </div>
    </div>

    <script>
      function calculateBond(nominal, price, commission, rate, term, coupons) {
        const investment = price * (1 + commission / 100);
        const couponAmount = (nominal * rate) / 100 / coupons;
        const periodLength = term / coupons;

        let totalCoupons = 0;
        for (let i = 1; i <= coupons; i++) {
          const timeToMaturity = term - i * periodLength;
          const reinvestedCoupon =
            couponAmount *
            Math.pow(1 + rate / 100, Math.max(0, timeToMaturity));
          totalCoupons += reinvestedCoupon;
        }

        const totalReturn = totalCoupons + nominal;
        const effectiveYield = Math.pow(totalReturn / investment, 1 / term) - 1;

        return {
          investment: investment,
          totalReturn: totalReturn,
          effectiveYield: effectiveYield * 100,
          couponAmount: couponAmount,
          periodLength: periodLength,
        };
      }

      function calculate() {
        const results = [];

        for (let i = 1; i <= 3; i++) {
          const nominal = parseFloat(
            document.getElementById(`nominal${i}`).value
          );
          const price = parseFloat(document.getElementById(`price${i}`).value);
          const commission = parseFloat(
            document.getElementById(`commission${i}`).value
          );
          const rate = parseFloat(document.getElementById(`rate${i}`).value);
          const term = parseFloat(document.getElementById(`term${i}`).value);
          const coupons = parseInt(
            document.getElementById(`coupons${i}`).value
          );

          const result = calculateBond(
            nominal,
            price,
            commission,
            rate,
            term,
            coupons
          );
          results.push(result);

          document.getElementById(`investment${i}`).textContent =
            result.investment.toFixed(2) + " грн";
          document.getElementById(`yield${i}`).textContent =
            result.effectiveYield.toFixed(2) + "%";
        }

        // Выделяем лучший вариант
        const bestYield = Math.max(...results.map((r) => r.effectiveYield));
        for (let i = 1; i <= 3; i++) {
          const yieldCell = document.getElementById(`yield${i}`);
          if (results[i - 1].effectiveYield === bestYield) {
            yieldCell.parentElement.className = "best";
          } else {
            yieldCell.parentElement.className = "result";
          }
        }

        showDetail();
      }

      function showDetail() {
        const variant = parseInt(
          document.getElementById("detailVariant").value
        );
        const nominal = parseFloat(
          document.getElementById(`nominal${variant}`).value
        );
        const price = parseFloat(
          document.getElementById(`price${variant}`).value
        );
        const commission = parseFloat(
          document.getElementById(`commission${variant}`).value
        );
        const rate = parseFloat(
          document.getElementById(`rate${variant}`).value
        );
        const term = parseFloat(
          document.getElementById(`term${variant}`).value
        );
        const coupons = parseInt(
          document.getElementById(`coupons${variant}`).value
        );

        const couponAmount = (nominal * rate) / 100 / coupons;
        const periodLength = term / coupons;

        let html =
          "<table><tr><th>№ купона</th><th>Время получения (лет)</th><th>Размер купона (грн)</th><th>Время до погашения (лет)</th><th>Реинвестированная стоимость (грн)</th></tr>";

        let totalCoupons = 0;
        for (let i = 1; i <= coupons; i++) {
          const timeReceived = i * periodLength;
          const timeToMaturity = term - timeReceived;
          const reinvestedValue =
            couponAmount *
            Math.pow(1 + rate / 100, Math.max(0, timeToMaturity));
          totalCoupons += reinvestedValue;

          html += `<tr>
                    <td>${i}</td>
                    <td>${timeReceived.toFixed(3)}</td>
                    <td>${couponAmount.toFixed(2)}</td>
                    <td>${timeToMaturity.toFixed(3)}</td>
                    <td>${reinvestedValue.toFixed(2)}</td>
                </tr>`;
        }

        html += `<tr class="result">
                <td colspan="4"><strong>Итого купоны + номинал:</strong></td>
                <td><strong>${(totalCoupons + nominal).toFixed(
                  2
                )} грн</strong></td>
            </tr>`;

        html += "</table>";
        document.getElementById("detailTable").innerHTML = html;
      }

      // Первоначальный расчет
      calculate();
    </script>
  </body>
</html>
